pts-quote: display a random quote on the console
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
pts-quote is a collection of command-line tools for choosing and displaying
a text quote (tagline, quote-of-the-day, QotD) randomly from a text file and
displaying it on the console. Currently it is implemented in assembly
language for DOS on the Intel 8086 and 286 architectures (and it can be run
in DOSBox and QEMU on modern systems).

The inital assembly language implementation for DOS on the Intel 286
architecture was written in 1996 for Turbo Pascal 7.0 inline assembly and
the A86 3.22 assembler, with the last version being quote.com.orig in this
repository. Maintenance work (mostly software archeology, porting to the
NASM 0.98.39 assembler and bugfixes) resumed on 2022-03-18. See the file
changelog.txt for more details.

To try the latest version from 1996:

* Download the latest snapshot of the pts-quote repository.
* Copy quote.com.orig to quote.com .
* Copy quote_demo_dos.txt to quote.txt .
* Install DOSBox.
* Run `dosbox .' (without the quotes) in the repository directory.
* Within the DOSBox window, run: del quote.idx
* Within the DOSBox window, run: quote
  This should display a random quote with a colorful banner and a frame.
  Run it again to get a different random quote.

File format of the text file quote.txt:

* Each line must be terminated with a CRLF (\r\n, ASCII 10 + 13).
* Quotes are separated by an empty line (i.e. CRLF + CRLF).
* There must be an empty line (i.e. CRLF + CRLF at the end of the file.
* Quotes must not be empty (i.e. CRLF + CRLF must not be followed by CRLF).
* Each quote must fit to 4095 bytes (including the trailing CRLF + CRLF).
* If a line starts with --, it will be right-aligned without the -- ,
  and it will be highlighted.
* If a line starts with -&, it will be center-aligned without the -& ,
  and it will be highlighted.
* Otherwise lines must not start with - .
* The file quote.txt must be at most 55 MiB in size.
* The file quote.txt must contain at least 1 and at most 65535 quotes.
* There is no validator. The program will misbehave for nonconforming
  quote.txt files.

About the index file quote.idx:

* The index file is autogenerated from quote.txt if it doesn't exist.
* If you modify quote.txt, delete quote.idx, there is no autodetection
  for regeneration.
* The index file contains file offset information to make it faster to find
  the random quote in quote.txt. The index file is binary.
* The file format of the index file depends on the version of the program.
  Versions 2.30 .. 2.5? use the verbose format 5, versions since 2.60 use
  the compact format 6. Delete quote.idx between using different versions.
* Format 5 (2..30 .. 2.5?) of quote.idx index file:
  * For each quote, encode its byte size (including the trailing CRLF +
    CRLF) as 1 or 2 8-bit unsigned integers. If the size is at most 239,
    emit it as 1 8-bit unsigned integer, otherwise emit 240 + the high 4
    bits as the first 8-bit unsigned integer, and then emit the low 8 bits
    as the second 8-bit unsigned integer. Equivalently, for decoding: read
    an 8-bit unsigned integer to hi. If it's at most 239, use it as the byte
    size of the next quote, otherwise read another 8-bit unsigned integer to
    hi, and use ((hi - 240) * 256 + lo) as the byte size of the next quote.
* Format 6 (2.6? ..) of quote.idx index file:
  * Emit the total number of quotes, as 2 bytes containing an 16-bit
    unsigned little-endian integer.
  * For each block of 1024 bytes (the last block may be shorter) in
    quote.txt, emit the number of quotes whose first byte this block
    contains, as a byte containing an 8-bit unsigned integer.
  * An invariant: the first 2 bytes (as a 16-bit unsigned little-endian
    integer) equals to the sum of the subsequent bytes (as 8-bit unsigned
    integers).

pts-quote is free software released under the GNU GPL v2 license. There is
NO WARRANTY. Use at your own risk.

__END__
